import{d as G,u as U,r as w,c as C,a as p,w as Y,b as k,e as f,f as u,o as v,g as m,h as I,i as M,j as g,k as A,F,l as S,H as b,m as H,n as K,t as O,p as q,_ as Q}from"./index-8ZdMb3LY.js";const W={async getCurrentPosition(){return new Promise((h,t)=>{navigator.geolocation||t(new Error("Geolocation is not supported by your browser")),navigator.geolocation.getCurrentPosition(s=>h(s.coords),s=>{switch(s.code){case 1:t(new Error("Permission was not granted to retrieve your location."));break;case 2:t(new Error("Your position is unavailable. Your device may not support geolocation."));break;case 3:t(new Error("A timeout occured waiting for your location information. Perhaps your device can't get a GPS fix"));break;default:t(new Error("Unable to retrieve your location."));break}})})}},z={class:"d-flex align-items-center mt-2"},J=G({__name:"LocationsView",setup(h){const t=U(),s=H(),a=w(""),c=w([]),E=C(()=>t.recentLocations.map(e=>({...e,key:`${e.lat},${e.lon}`,displayName:p.geoToString(e)})));async function y(e){await t.updateLocation(e),t.hasLocation&&(a.value=t.locationDisplayName,s.push("/"))}function L(){t.hasLocation?s.push("/"):t.addMessage("You need to set a location to continue.")}function x(e){t.deleteRecentLocation(e)}async function $(e){if(e===null)return;const o=c.value.find(i=>e===p.geoToString(i));o===void 0?d("couldn't find the value you selected."):await y(o),c.value=[]}function N(){a.value="",c.value=[]}const T=C(()=>{const e=new Set,o=[];for(const l of c.value){const n=p.geoToString(l);e.has(n)?(console.log(`${n} is a duplicate!`),o.push(n)):e.add(n)}const i=[];for(const l of c.value){let n=p.geoToString(l);o.includes(n)&&(n=p.geoToString(l,!0)),i.push(n)}return i});async function P(){console.log("handleGeoSearch");try{const e=await W.getCurrentPosition();try{const o=await S.searchCityByCoords(e.latitude,e.longitude,t.apiKey);o[0]!==void 0&&await y(o[0])}catch(o){o instanceof b&&o.httpStatusCode===401?s.push("/settings"):o instanceof Error&&d(`could not determine your city from your location. ${o.message}`)}}catch(e){e instanceof Error&&d(`could not retrieve your location: ${e.message}`)}}Y(a,_,{debounce:1e3});async function _(){if(console.log(`doSearch: ${a.value}`),a.value!=="")try{const e=await S.searchCoordsByCity(a.value,t.apiKey);e.length===0?d("could not find any cities for your location."):c.value=e}catch(e){e instanceof b&&e.httpStatusCode===401?s.push("/settings"):e instanceof Error&&d(`could not determine a city for your location: ${e.message}`)}}function d(e){console.log(e),t.addMessage(`I'm sorry, we ${e}`)}return(e,o)=>{const i=u("v-list-item"),l=u("v-icon"),n=u("v-list"),R=u("v-autocomplete"),V=u("v-btn"),B=u("v-container");return v(),k(B,{fluid:"",class:"d-flex flex-column justify-content-end h-100"},{default:f(()=>[m(n,{lines:"three"},{default:f(()=>[m(i,{"prepend-icon":"mdi-crosshairs",key:"CURRENT_LOCATION",class:"d-flex align-items-center",onClick:P},{default:f(()=>[...o[2]||(o[2]=[g(" Your current location ",-1)])]),_:1}),(v(!0),M(F,null,A(E.value,r=>(v(),k(i,{"prepend-icon":"mdi-map-check-outline",class:"d-flex justify-content-between align-items-center",onClick:D=>y(r),key:r.key},{default:f(()=>[g(O(r.displayName)+" ",1),K(e.$slots,"append",{},()=>[m(l,{icon:"mdi-trash-can-outline",onClick:q(D=>x(r),["stop"])},null,8,["onClick"])],!0)]),_:2},1032,["onClick"]))),128))]),_:3}),I("div",z,[m(R,{class:"mx-2",search:a.value,"onUpdate:search":o[0]||(o[0]=r=>a.value=r),items:T.value,"onUpdate:modelValue":o[1]||(o[1]=r=>$(r)),"prepend-icon":"mdi-magnify","onClick:prepend":_,"append-icon":"mdi-close","onClick:append":N},null,8,["search","items"]),m(V,{onClick:L,class:"mt-2"},{default:f(()=>[...o[3]||(o[3]=[g("Done",-1)])]),_:1})])]),_:3})}}}),Z=Q(J,[["__scopeId","data-v-30b91009"]]);export{Z as default};
